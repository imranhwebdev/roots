{% comment %}
  Add this CSS to your stylesheet section at the top
{% endcomment %}
{% stylesheet %}
  .product-area .product-image,
  .product-area .product-image img {
    height: 100%;
  }
  .product-area .product-image img {
    border-radius: 8px;
  }
  .tab-btn.active {
    border-bottom: 2px solid #1e6c44;
    color: #1e6c44;
  }

  /* Judge.me Custom Styling */
  .jdgm-widget * {
    font-family: inherit !important;
  }

  .jdgm-rev-widg__summary-stars {
    margin-bottom: 1rem !important;
  }

  .jdgm-rev-widg__reviews {
    margin-top: 1.5rem !important;
  }

  .jdgm-rev__author {
    color: #1e6c44 !important;
    font-weight: 600 !important;
  }

  .jdgm-rev__timestamp {
    color: #797375 !important;
  }

  .jdgm-rev__title {
    color: #514849 !important;
    font-weight: 600 !important;
    margin-bottom: 0.5rem !important;
  }

  .jdgm-rev__body {
    color: #514849 !important;
    line-height: 1.6 !important;
  }

  .jdgm-star {
    color: #ffc801 !important;
  }

  .jdgm-paginate__page-btn {
    background-color: #1e6c44 !important;
    color: white !important;
    border-radius: 4px !important;
    padding: 0.5rem 1rem !important;
  }

  .jdgm-write-rev-link {
    background-color: #1e6c44 !important;
    color: white !important;
    border-radius: 8px !important;
    padding: 0.75rem 1.5rem !important;
    text-decoration: none !important;
    display: inline-block !important;
    margin-bottom: 1rem !important;
    transition: background-color 0.3s ease !important;
  }
  .jdgm-write-rev-link:hover {
    color: white !important;
    background-color: #155a37 !important;
  }

  /* Hide Judge.me default elements that might conflict */
  .jdgm-widget .jdgm-widget__title {
    display: none !important;
  }

  .jdgm-row-rating {
    width: max-content;
    display: flex;
    flex-direction: column-reverse;
    position: absolute;
    right: 0;
  }
  .jdgm-row-media {
    display: none !important;
  }

  /* desc ar css code  start*/

  #tab-desc ul {
    list-style-type: none;
    margin-bottom: 1rem;
    padding-right: 15%;
  }
  #tab-desc ul li {
    display: flex;
    align-items: center;
    gap: 12px;
    color: #797375;
    font-size: 20px;
    line-height: 1.6;
    position: relative;
    margin-bottom: 24px;
  }
  #tab-desc ul li::before {
    content: '';
    display: inline-block;
    width: 40px;
    height: 40px;
    background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40' fill='none'><path d='M23.03 19.7987L7.27246 7.27344V32.526L23.03 19.7987Z' fill='%231E6C44'/><path d='M19.3934 9.29492H14.5449L27.8783 19.8L15.353 29.901H19.7974L32.3227 19.8L19.3934 9.29492Z' fill='%23103C25'/></svg>")
      no-repeat center;
    background-size: contain;
    flex-shrink: 0;
  }

  .jdgm-rev-widg__title {
    text-align: start !important;
    color: #0d2e1d;
    font-size: 34px;
    font-weight: 500;
  }
  a.jdgm-write-rev-link {
    background: white !important;
    border: 1px solid #1e6c44 !important;
    padding: 18px 32px !important;
    color: #1f1904 !important;
    font-size: 20px;
    font-weight: 500;
    line-height: 120%;
    border-radius: 40px !important;
  }
  .jdgm-row-actions {
    border-top: 1px solid #e7e6e4 !important;
    padding: 16px 0 !important;
  }
  .jdgm-sort-dropdown-wrapper {
    display: flex !important;
    justify-content: end !important;
  }
  .jdgm-rev__pic-img.jdgm-rev__pic-img {
    border-radius: 100%;
  }
  select.jdgm-sort-dropdown {
    border-radius: 70px;
    border: 1px solid #e3e2e0;
    padding: 14px 24px;
    color: #514849 !important;
    font-size: 18px;
    font-weight: 150% !important;
    cursor: pointer;
    background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='none' stroke='%23514849' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='4 6 8 10 12 6'/></svg>")
      no-repeat right 16px center;
    background-size: 16px;
  }
  .jdgm-sort-dropdown-arrow {
    display: none !important;
  }

  .jdgm-rev.jdgm-divider-top.jdgm--done-setup {
    border-top: none;
  }

  .jdgm-row-profile .jdgm-rev__author-wrapper .jdgm-rev__author {
    color: #0d2e1d !important;
    font-size: 20px !important;
    font-weight: 500 !important;
    line-height: 150% !important;
  }
  .jdgm-rev__icon {
    width: 48px !important;
    height: 48px !important;
    border-radius: 100% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }
  .jdgm-rev__body p {
    font-size: 18px !important;
    line-height: 160% !important;
    color: #797375 !important;
  }
  .jdgm-rev__timestamp {
    font-size: 18px !important;
    font-weight: 500 !important;
    line-height: 150% !important;
  }
  .jdgm-rev-widg__summary-average {
    font-size: 20px !important;
    font-weight: 500 !important;
    line-height: 150% !important;
    color: #514849 !important;
  }
  .jdgm-rev-widg__summary-text {
    font-size: 18px !important;
    line-height: 150% !important;
    color: #797375 !important;
  }
  .jdgm-rev-widg__summary-text img {
    display: none !important;
  }
  .jdgm-widget:not(.jdgm-review-widget--small, .jdgm-review-widget--medium) .jdgm-row-stars > div {
    align-items: start !important;
    justify-content: start !important;
  }
  @media (max-width: 768px) {
    #tab-desc ul li {
      font-size: 16px;
    }
    #tab-desc ul {
      padding-right: 0px;
    }
    .jdgm-rev-widg__title {
      font-size: 26px;
      margin-bottom: 16px !important;
    }
    .jdgm-rev__timestamp {
      font-size: 14px !important;
    }
    .jdgm-rev-widg__summary-average {
      font-size: 18px !important;
    }
    .jdgm-rev-widg__summary-text {
      font-size: 14px !important;
    }
  }
  .jdgm-widget:not(.jdgm-review-widget--small, .jdgm-review-widget--medium) .jdgm-row-stars > div {
    align-items: start;
    justify-content: space-around;
  }
  @media (max-width: 390px) {
    #tab-desc ul li {
      font-size: 14px;
      margin-bottom: 20px;
      align-items: start;
      margin-top: 4px;
    }
    #tab-desc ul li::before {
      width: 24px;
      height: 24px;
    }
    .jdgm-rev-widg__title {
      font-size: 20px;
      text-align: center !important;
    }
    .jdgm-rev__body p {
      font-size: 14px !important;
    }
  }
  /* desc ar css code  end*/
{% endstylesheet %}

<div class="product-details-area pt-9">
  <div class="container !max-w-[1400px] mx-auto">
    <div class="bradcramp">
      <ul>
        <li class="text-lg lg:text-xl text-[#797375] flex items-center ">
          Shop
          <span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M9.55556 17L14 12L9.55556 7" stroke="#797375" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="text-[#514849] font-medium">Product Details</span>
        </li>
      </ul>
    </div>

    <div class="product-area mt-10">
      <div class="w-full">
        <div class="flex flex-col md:flex-row flex-wrap md:flex-nowrap gap-6 items-center justify-between w-full">
          <div class="w-full md:w-1/2 xl:w-5/12">
            <div class="size-full lg:h-135.5 lg:w-110.5 shadow-[-8px_-10px_#FFC801] rounded-lg">
              {% for image in product.images %}
                {% render 'image', class: 'product-image', image: image %}
              {% endfor %}
            </div>
          </div>

          <div class="w-full md:w-1/2 xl:w-6/12 mb-8 md:mb-0 ">
            <div class="xl:mr-10">
              <span class="text-xs md:text-base block !leading-[1.2] uppercase tracking-[1.92px] bg-[#B7D6C6] rounded-[50px] py-3 px-6 max-w-max mb-4"
                >Order today and get 15% OFF</span
              >
              <h4 class="text-2xl md:text-3xl lg:text-4xl xl:text-[44px] text-green font-bold mb-2 font-armany-bold !leading-[1.25]">
                {{ product.title }}
              </h4>

              <div class="text-base md:text-lg lg:text-xl font-poppins mb-5">
                {% assign description_html = product.description %}
                {% assign list_items = description_html | split: '<li>' %}
                {% assign only_paragraphs = description_html | remove: '<ul>' | remove: '</ul>' %}

                {% for item in list_items %}
                  {% if item contains '</li>' %}
                    {% assign clean_li = '<li>' | append: item | split: '</li>' | first | append: '</li>' %}
                    {% assign only_paragraphs = only_paragraphs | remove: clean_li %}
                  {% endif %}
                {% endfor %}

                <div class="prose  text-[#514849] text-sm md:text-base lg:text-xl lading-[160%] mb-5">
                  {{ only_paragraphs }}
                </div>

                {% if list_items.size > 1 %}
                  <ul class="mb-6 space-y-2 text-[#1E6C44] font-medium">
                    {% for item in list_items %}
                      {% if item contains '</li>' %}
                        <li class="flex items-center gap-2 text-[#1E6C44] text-base lg:text-lg xl:text-[22px] !leading-[1.6] font-medium">
                          <svg
                            width="25"
                            height="25"
                            viewBox="0 0 25 25"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M22.8262 11.5799V12.4999C22.8249 14.6563 22.1267 16.7545 20.8355 18.4817C19.5443 20.2088 17.7295 21.4723 15.6615 22.0838C13.5936 22.6952 11.3834 22.6218 9.36064 21.8744C7.33785 21.1271 5.61083 19.746 4.43713 17.9369C3.26344 16.1279 2.70596 13.9879 2.84785 11.8362C2.98973 9.68443 3.82338 7.63619 5.22445 5.99694C6.62552 4.35768 8.51896 3.21525 10.6224 2.74001C12.7258 2.26477 14.9264 2.4822 16.8962 3.35986M22.8262 4.49986L12.8262 14.5099L9.82618 11.5099" stroke="#1E6C44" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                          {{ item | split: '</li>' | first | strip }}
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                {% endif %}
              </div>

              <div class="mb-6">
                <!-- Judge.me Product Rating Widget -->
                <div
                  class="jdgm-widget jdgm-preview-badge text-sm lg:text-base !leading-[1.6] text-[#797375]"
                  data-id="{{ product.id }}"
                >
                  {{ product.metafields.judgeme.badge }}
                </div>
                <div class="flex items-center gap-4 mb-6 mt-4 xl:mb-8">
                  <div class="flex items-center bg-[#F0F0F0] rounded-[90px] p-1.5">
                    <button
                      type="button"
                      onclick="changeQty(-1)"
                      class="size-9 lg:size-10 cursor-pointer hover:bg-primary transform ease-in-out duration-300 flex items-center justify-center rounded-full border border-[#EEEFEE] bg-white"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="size-4 lg:size-5"
                        width="100%"
                        height="100%"
                        viewBox="0 0 21 20"
                        fill="none"
                      >
                        <path d="M4.43457 10H16.1012" stroke="#858484" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                    <input id="quantity" type="number" min="1" value="1" class="w-12 text-center pl-3">
                    <button
                      type="button"
                      onclick="changeQty(1)"
                      class="size-9 lg:size-10 cursor-pointer hover:bg-primary transform ease-in-out duration-300 flex items-center justify-center rounded-full border border-[#EEEFEE] bg-white"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="size-4 lg:size-5"
                        width="100%"
                        height="100%"
                        viewBox="0 0 21 20"
                        fill="none"
                      >
                        <path d="M10.6839 4.16602V15.8327M4.85059 9.99935H16.5173" stroke="#424242" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                  <p id="total-price" class="text-xl lg:text-[26px] xl:text-3xl font-semibold !leading-[1.2]">
                    {{ product.price | money }}
                  </p>
                </div>
              </div>

              <div class="flex items-center gap-3 lg:gap-5">
                <a
                  href="javascript:void(0);"
                  onclick="shopNow({{ product.selected_or_first_available_variant.id }})"
                  class="btn flex items-center gap-3 !text-base lg:!text-lg xl:!text-xl"
                >
                  Shop Now
                  <svg
                    width="17"
                    height="13"
                    viewBox="0 0 17 13"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M10.332 1L15.832 6.5M15.832 6.5L10.332 12M15.832 6.5L1.16536 6.5"
                      stroke="currentColor"
                      stroke-width="1.8"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a>

                <button
                  class="inline-btn text-[#1F1904] hover:text-white add-to-cart-btn !text-base lg:!text-lg xl:!text-xl"
                  data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                  data-product-title="{{ product.title }}"
                >
                  <span class="btn-text">Add to Cart</span>
                  <span class="btn-loading hidden">
                    <svg class="animate-spin h-4 w-4 inline-block" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Adding...
                  </span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs: Description + Reviews -->
    <div class="mt-12">
      <div class="border-b flex items-center border px-4 lg:px-5  pt-4 border-[#B7D6C6] rounded-lg gap-6 lg:gap-9">
        <button
          class="tab-btn active border cursor-pointer pb-4 border-transparent text-[#514849] text-sm md:text-base lg:text-lg xl:text-xl !leading-[1.6] font-medium"
          data-tab="desc"
        >
          Product Description
        </button>
        <button
          class="tab-btn pb-4 border border-transparent cursor-pointer text-[#514849] text-sm md:text-base lg:text-lg xl:text-xl !leading-[1.6] font-medium"
          data-tab="reviews"
        >
          Customer Reviews
        </button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content mt-6">
        <!-- Description -->
        <div id="tab-desc" class="tab-pane active prose max-w-none">
          {% if product.metafields.custom.product_description != blank %}
            {{ product.metafields.custom.product_description | metafield_tag }}
          {% else %}
            {{ product.description }}
          {% endif %}
        </div>

        <!-- Reviews (Judge.me Widget) -->
        <div id="tab-reviews" class="tab-pane hidden customer-reviews">
          <!-- Start of Judge.me code -->
          <div style="clear:both"></div>
          <div
            id="judgeme_product_reviews"
            class="jdgm-widget jdgm-review-widget"
            data-product-title="{{ product.title | escape }}"
            data-id="{{ product.id }}"
            data-auto-install="false"
          >
            {{ product.metafields.judgeme.widget }}
          </div>
          <!-- End of Judge.me code -->
        </div>
      </div>
    </div>
  </div>
</div>

{% comment %}
  Add this to your theme.liquid file in the <head> section if not already present
{% endcomment %}
{% comment %}
  <script async src="https://cdn.judge.me/widgets/platform.js"></script>
{% endcomment %}

<script>
  // === Quantity Change ===
  function changeQty(amount) {
    const qtyInput = document.getElementById("quantity");
    let value = parseInt(qtyInput.value);
    if (!isNaN(value)) {
      value += amount;
      if (value < 1) value = 1;
      qtyInput.value = value;
      updatePrice();
    }
  }

  // === Tabs ===
  document.addEventListener("DOMContentLoaded", function () {
    const tabBtns = document.querySelectorAll(".tab-btn");
    const tabPanes = document.querySelectorAll(".tab-pane");

    tabBtns.forEach((btn) => {
      btn.addEventListener("click", function () {
        const target = this.getAttribute("data-tab");

        tabBtns.forEach((b) => b.classList.remove("active"));
        tabPanes.forEach((p) => p.classList.add("hidden"));

        this.classList.add("active");
        document.getElementById("tab-" + target).classList.remove("hidden");

        // Judge.me refresh
        if (target === "reviews") {
          if (window.jdgm && window.jdgm.reviewWidget) {
            window.jdgm.reviewWidget.render();
          }
        }
      });
    });

    if (window.jdgm) {
      window.jdgm.customizeBadge({
        hideEmptyBadges: false,
      });
    }
  });

  // === Add to Cart Button ===
  document.addEventListener("DOMContentLoaded", function () {
    const addToCartBtn = document.querySelector(".add-to-cart-btn");

    addToCartBtn.addEventListener("click", function () {
      const variantId = this.getAttribute("data-variant-id");
      const qty = parseInt(document.getElementById("quantity").value) || 1;

      this.querySelector(".btn-text").classList.add("hidden");
      this.querySelector(".btn-loading").classList.remove("hidden");

      fetch("/cart/add.js", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Accept: "application/json",
        },
        body: JSON.stringify({
          id: variantId,
          quantity: qty,
        }),
      })
        .then((res) => res.json())
        .then((data) => {
          console.log("Added to cart:", data);
          window.location.href = "/cart"; // redirect to checkout
        })
        .catch((err) => console.error("Error:", err))
        .finally(() => {
          this.querySelector(".btn-text").classList.remove("hidden");
          this.querySelector(".btn-loading").classList.add("hidden");
        });
    });
  });

  // === Shop Now Button ===
  function shopNow(variantId) {
    const qty = parseInt(document.getElementById("quantity").value) || 1;

    fetch("/cart/add.js", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Accept: "application/json",
      },
      body: JSON.stringify({
        id: variantId,
        quantity: qty,
      }),
    })
      .then((res) => res.json())
      .then((data) => {
        console.log("Shop Now Added:", data);
        window.location.href = "/checkout"; // redirect to checkout
      })
      .catch((err) => console.error("Error:", err));
  }

  // === Price Update ===
  document.addEventListener("DOMContentLoaded", function () {
    const qtyInput = document.getElementById("quantity");
    const totalPriceEl = document.getElementById("total-price");

    const unitPrice = {{ product.price | divided_by: 100 }};

    window.updatePrice = function () {
      let qty = parseInt(qtyInput.value) || 1;
      let total = unitPrice * qty;

      totalPriceEl.textContent = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "{{ shop.currency }}",
      }).format(total);
    };

    qtyInput.addEventListener("input", updatePrice);

    document.querySelectorAll(".quantity-btn").forEach((btn) => {
      btn.addEventListener("click", updatePrice);
    });

    // Initial
    updatePrice();
  });
</script>

{% schema %}
{
  "name": "t:general.product",
  "settings": [],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
