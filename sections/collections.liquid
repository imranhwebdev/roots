{% assign product1 = all_products[section.settings.layout_1_product] %}
{% assign product2 = all_products[section.settings.layout_2_product] %}
{% assign product3 = all_products[section.settings.layout_3_product] %}

<!-- Toast Notification for Cart Success -->
<div
  id="cart-success-toast"
  class="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg transform translate-x-full opacity-0 transition-all duration-300 z-50"
>
  <div class="flex items-center gap-3">
    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
    </svg>
    <span id="cart-success-message">Product added to cart!</span>
  </div>
</div>

<!-- Layout 1 -->
{% if product1 %}
  <section class="best-seller bg-[#B7D6C6] py-10 md:py-14 lg:py-20 xl:py-25">
    <div class="container">
      <div class="w-full 2xl:w-10/12 mx-auto">
        <div class="flex flex-col md:flex-row flex-wrap md:flex-nowrap gap-4 items-center justify-between w-full">
          <div class="w-full md:w-1/2 xl:w-5/12 order-2 md:order-1">
            <div class="xl:ml-10 size-full lg:h-135.5 lg:w-110.5 shadow-[-8px_-10px_#FFC801] rounded-lg lg:rounded-[10px] lg:shadow-[-10px_-10px_#FFC801]">
              <img
                src="{{ product1.featured_image | image_url }}"
                alt="{{ product1.title }}"
                class="size-full"
                width=""
                height=""
              >
            </div>
          </div>
          <div class="w-full md:w-1/2 xl:w-6/12 mb-8 md:mb-0 order-1 md:order-2">
            <div class=" xl:mr-10">
              <h4 class="text-2xl md:text-3xl lg:text-4xl xl:text-[44px] text-green font-bold mb-4">
                {{ product1.title }}
              </h4>

              <div class="text-base md:text-lg lg:text-xl font-poppins mb-5">
                {% assign description_html = product1.description %}
                {% assign list_items = description_html | split: '<li>' %}

                {% assign only_paragraphs = description_html | remove: '<ul>' | remove: '</ul>' %}
                {% for item in list_items %}
                  {% if item contains '</li>' %}
                    {% assign clean_li = '<li>' | append: item | split: '</li>' | first | append: '</li>' %}
                    {% assign only_paragraphs = only_paragraphs | remove: clean_li %}
                  {% endif %}
                {% endfor %}

                <div class="prose text-para lading-[160%] mb-4">
                  {{ only_paragraphs }}
                </div>

                {% if list_items.size > 1 %}
                  <ul class="mb-6 space-y-2 text-[#1E6C44] font-medium">
                    {% for item in list_items %}
                      {% if item contains '</li>' %}
                        <li class="flex items-center gap-2">
                          <svg
                            width="25"
                            height="25"
                            viewBox="0 0 25 25"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M22.8262 11.5799V12.4999C22.8249 14.6563 22.1267 16.7545 20.8355 18.4817C19.5443 20.2088 17.7295 21.4723 15.6615 22.0838C13.5936 22.6952 11.3834 22.6218 9.36064 21.8744C7.33785 21.1271 5.61083 19.746 4.43713 17.9369C3.26344 16.1279 2.70596 13.9879 2.84785 11.8362C2.98973 9.68443 3.82338 7.63619 5.22445 5.99694C6.62552 4.35768 8.51896 3.21525 10.6224 2.74001C12.7258 2.26477 14.9264 2.4822 16.8962 3.35986M22.8262 4.49986L12.8262 14.5099L9.82618 11.5099" stroke="#1E6C44" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                          {{ item | split: '</li>' | first | strip }}
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                {% endif %}
              </div>

              <p class="text-xl lg:text-[26px] font-semibold">
                {{ product1.price | money }}
              </p>
              <div class="flex items-center gap-5 mt-3.5">
                <button
                  class="btn add-to-cart-btn"
                  data-variant-id="{{ product1.selected_or_first_available_variant.id }}"
                  data-product-title="{{ product1.title }}"
                >
                  <span class="btn-text">Add to Cart</span>
                  <span class="btn-loading hidden">
                    <svg class="animate-spin h-4 w-4 inline-block" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Adding...
                  </span>
                </button>
                <a
                  href="{{product1.url}}"
                  class="inline-btn border border-solid border-[#1E6C44] text-[#1F1904] hover:text-white hover:border-primary transition duration-300 flex items-center gap-3"
                >
                  View Details
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endif %}

<!-- Layout 2 -->
{% if product2 %}
  <section class=" bg-white py-10 md:py-14 lg:py-20 xl:py-25 mt-17.5 md:mt-0">
    <div class="container">
      <div class="w-full 2xl:w-10/12 mx-auto">
        <div class="flex flex-col md:flex-row flex-wrap md:flex-nowrap gap-4 items-center justify-between w-full">
          <div class="w-full md:w-1/2 xl:w-6/12 mb-8 md:mb-0 ">
            <div class=" xl:ml-10">
              <h4 class="text-2xl md:text-3xl lg:text-4xl xl:text-[44px] text-green font-bold mb-4">
                {{ product2.title }}
              </h4>

              <div class="text-base md:text-lg lg:text-xl font-poppins mb-5">
                {% assign description_html = product2.description %}
                {% assign list_items = description_html | split: '<li>' %}

                {% assign only_paragraphs = description_html | remove: '<ul>' | remove: '</ul>' %}
                {% for item in list_items %}
                  {% if item contains '</li>' %}
                    {% assign clean_li = '<li>' | append: item | split: '</li>' | first | append: '</li>' %}
                    {% assign only_paragraphs = only_paragraphs | remove: clean_li %}
                  {% endif %}
                {% endfor %}

                <div class="prose mb-4 text-para text-base lg:text-xl leading-[160%]">
                  {{ only_paragraphs }}
                </div>

                {% if list_items.size > 1 %}
                  <ul class="mb-6 space-y-2 text-[#1E6C44] font-medium">
                    {% for item in list_items %}
                      {% if item contains '</li>' %}
                        <li class="flex items-center gap-2">
                          <svg
                            width="25"
                            height="25"
                            viewBox="0 0 25 25"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M22.8262 11.5799V12.4999C22.8249 14.6563 22.1267 16.7545 20.8355 18.4817C19.5443 20.2088 17.7295 21.4723 15.6615 22.0838C13.5936 22.6952 11.3834 22.6218 9.36064 21.8744C7.33785 21.1271 5.61083 19.746 4.43713 17.9369C3.26344 16.1279 2.70596 13.9879 2.84785 11.8362C2.98973 9.68443 3.82338 7.63619 5.22445 5.99694C6.62552 4.35768 8.51896 3.21525 10.6224 2.74001C12.7258 2.26477 14.9264 2.4822 16.8962 3.35986M22.8262 4.49986L12.8262 14.5099L9.82618 11.5099" stroke="#1E6C44" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                          {{ item | split: '</li>' | first | strip }}
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                {% endif %}
              </div>

              <p class="text-xl lg:text-[26px] font-semibold">
                {{ product2.price | money }}
              </p>
              <div class="flex items-center gap-5 mt-3.5">
                <button
                  class="btn add-to-cart-btn"
                  data-variant-id="{{ product1.selected_or_first_available_variant.id }}"
                  data-product-title="{{ product1.title }}"
                >
                  <span class="btn-text">Add to Cart</span>
                  <span class="btn-loading hidden">
                    <svg class="animate-spin h-4 w-4 inline-block" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Adding...
                  </span>
                </button>
                <a
                  href="{{product1.url}}"
                  class="inline-btn border border-solid border-[#1E6C44] text-[#1F1904] hover:text-white hover:border-primary transition duration-300 flex items-center gap-3"
                >
                  View Details
                </a>
              </div>
            </div>
          </div>

          <div class="w-full md:w-1/2 xl:w-5/12 ">
            <div class="xl:ml-10 size-full lg:h-135.5 lg:w-110.5 shadow-[8px_-10px_#FFC801] rounded-lg">
              <img
                src="{{ product2.featured_image | image_url }}"
                width=""
                height=""
                alt="{{ product2.title }}"
                class="size-full rounded-[10px]"
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endif %}

<!-- Layout 3 -->
{% if product3 %}
  <section class="best-seller bg-[#F0ECDC] py-10 md:py-14 lg:py-20 xl:py-25">
    <div class="container">
      <div class="w-full 2xl:w-10/12 mx-auto">
        <div class="flex flex-col md:flex-row flex-wrap md:flex-nowrap gap-4 items-center justify-between w-full">
          <div class="w-full md:w-1/2 xl:w-5/12 order-2 md:order-1">
            <div class="xl:ml-10 size-full lg:h-135.5 lg:w-110.5 shadow-[-8px_-10px_#FFC801] rounded-lg">
              <img
                src="{{ product3.featured_image | image_url }}"
                alt="{{ product3.title }}"
                width=""
                height=""
                class="size-full"
              >
            </div>
          </div>
          <div class="w-full md:w-1/2 xl:w-6/12 mb-8 md:mb-0 order-1 md:order-2">
            <div class=" xl:mr-10">
              <h4 class="text-2xl md:text-3xl lg:text-4xl xl:text-[44px] text-green font-bold mb-4">
                {{ product3.title }}
              </h4>

              <div class="text-base md:text-lg lg:text-xl font-poppins mb-5">
                {% assign description_html = product3.description %}
                {% assign list_items = description_html | split: '<li>' %}

                {% assign only_paragraphs = description_html | remove: '<ul>' | remove: '</ul>' %}
                {% for item in list_items %}
                  {% if item contains '</li>' %}
                    {% assign clean_li = '<li>' | append: item | split: '</li>' | first | append: '</li>' %}
                    {% assign only_paragraphs = only_paragraphs | remove: clean_li %}
                  {% endif %}
                {% endfor %}

                <div class="prose text-para lading-[160%] mb-4">
                  {{ only_paragraphs }}
                </div>

                {% if list_items.size > 1 %}
                  <ul class="mb-6 space-y-2 text-[#1E6C44] font-medium">
                    {% for item in list_items %}
                      {% if item contains '</li>' %}
                        <li class="flex items-center gap-2">
                          <svg
                            width="25"
                            height="25"
                            viewBox="0 0 25 25"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M22.8262 11.5799V12.4999C22.8249 14.6563 22.1267 16.7545 20.8355 18.4817C19.5443 20.2088 17.7295 21.4723 15.6615 22.0838C13.5936 22.6952 11.3834 22.6218 9.36064 21.8744C7.33785 21.1271 5.61083 19.746 4.43713 17.9369C3.26344 16.1279 2.70596 13.9879 2.84785 11.8362C2.98973 9.68443 3.82338 7.63619 5.22445 5.99694C6.62552 4.35768 8.51896 3.21525 10.6224 2.74001C12.7258 2.26477 14.9264 2.4822 16.8962 3.35986M22.8262 4.49986L12.8262 14.5099L9.82618 11.5099" stroke="#1E6C44" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                          {{ item | split: '</li>' | first | strip }}
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                {% endif %}
              </div>

              <p class="text-xl lg:text-[26px] font-semibold">
                {{ product3.price | money }}
              </p>
              <div class="flex items-center gap-5 mt-3.5">
                <button
                  class="btn add-to-cart-btn"
                  data-variant-id="{{ product1.selected_or_first_available_variant.id }}"
                  data-product-title="{{ product1.title }}"
                >
                  <span class="btn-text">Add to Cart</span>
                  <span class="btn-loading hidden">
                    <svg class="animate-spin h-4 w-4 inline-block" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Adding...
                  </span>
                </button>
                <a
                  href="{{product1.url}}"
                  class="inline-btn border border-solid border-[#1E6C44] text-[#1F1904] hover:text-white hover:border-primary transition duration-300 flex items-center gap-3"
                >
                  View Details
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endif %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Get all add to cart buttons
    const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
    const toast = document.getElementById('cart-success-toast');
    const toastMessage = document.getElementById('cart-success-message');

    // Function to show toast notification
    function showToast(message) {
      toastMessage.textContent = message;
      toast.classList.remove('translate-x-full', 'opacity-0');
      toast.classList.add('translate-x-0', 'opacity-100');

      setTimeout(() => {
        toast.classList.remove('translate-x-0', 'opacity-100');
        toast.classList.add('translate-x-full', 'opacity-0');
      }, 3000);
    }

    // Function to update cart count (if you have a cart counter in your theme)
    function updateCartCount() {
      fetch('/cart.js')
        .then((response) => response.json())
        .then((cart) => {
          const cartCountElements = document.querySelectorAll('.cart-count');
          cartCountElements.forEach((element) => {
            element.textContent = cart.item_count;
          });
        });
    }

    // Add click event listeners to all add to cart buttons
    addToCartButtons.forEach((button) => {
      button.addEventListener('click', function (e) {
        e.preventDefault();

        const variantId = this.getAttribute('data-variant-id');
        const productTitle = this.getAttribute('data-product-title');
        const btnText = this.querySelector('.btn-text');
        const btnLoading = this.querySelector('.btn-loading');

        // Show loading state
        btnText.classList.add('hidden');
        btnLoading.classList.remove('hidden');
        this.disabled = true;

        // Add item to cart
        fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            id: variantId,
            quantity: 1,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            // Reset button state
            btnText.classList.remove('hidden');
            btnLoading.classList.add('hidden');
            this.disabled = false;

            // Show success message
            showToast(`${productTitle} added to cart!`);

            // Update cart count
            updateCartCount();

            // Optional: Trigger any custom cart drawer or refresh cart
            if (typeof window.theme !== 'undefined' && window.theme.cart) {
              window.theme.cart.refresh();
            }
          })
          .catch((error) => {
            console.error('Error:', error);

            // Reset button state
            btnText.classList.remove('hidden');
            btnLoading.classList.add('hidden');
            this.disabled = false;

            // Show error message
            showToast('Error adding product to cart. Please try again.');
          });
      });
    });
  });
</script>

{% schema %}
{
  "name": "3 Layout Product Section",
  "settings": [
    {
      "type": "product",
      "id": "layout_1_product",
      "label": "Layout 1 Product"
    },
    {
      "type": "product",
      "id": "layout_2_product",
      "label": "Layout 2 Product"
    },
    {
      "type": "product",
      "id": "layout_3_product",
      "label": "Layout 3 Product"
    }
  ],
  "presets": [
    {
      "name": "3 Layout Product Section"
    }
  ]
}
{% endschema %}
