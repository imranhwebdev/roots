{% if product.metafields.custom.product_video_reviews != blank %}
  <div class="our-customer py-15 md:py-20 lg:py-37.5">
    <div class="container !max-w-[1220px] mx-auto px-4">
      <div class="our-customer-wrapper">
        <div class="section-title text-center mb-12">
          <h2 class="title text-3xl lg:text-[44px] font-bold text-[#0D2E1D] font-armany-bold leading-tight mb-4">
            {{ section.settings.heading }}
          </h2>
          {% if section.settings.subheading != blank %}
            <p class="description text-[#797375] text-base md:text-lg lg:text-xl leading-[1.6] font-poppins">
              {{ section.settings.subheading }}
            </p>
          {% endif %}
        </div>

        <div class="relative z-1">
          <div class="swiper review-slider">
            <div class="swiper-wrapper">
              {% for video_url in product.metafields.custom.product_video_reviews.value %}
                {% assign video_id = video_url %}
                {% if video_url contains 'watch?v=' %}
                  {% assign video_id = video_url | split: 'watch?v=' | last | split: '&' | first %}
                {% elsif video_url contains 'youtu.be/' %}
                  {% assign video_id = video_url | split: 'youtu.be/' | last | split: '?' | first %}
                {% elsif video_url contains '/shorts/' %}
                  {% assign video_id = video_url | split: '/shorts/' | last | split: '?' | first %}
                {% endif %}

                <div class="swiper-slide">
                  <div class="rounded-[10px]">
                    <div class="relative w-full h-75 md:h-[400px] lg:h-[500px] xl:h-[600px] group overflow-hidden rounded-xl">
                      <!-- YouTube thumbnail -->
                      <img
                        src="https://img.youtube.com/vi/{{ video_id }}/hqdefault.jpg"
                        alt="Video thumbnail"
                        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105 rounded-xl"
                        loading="lazy"
                      >

                      <!-- Play button -->
                      <button
                        type="button"
                        data-video-id="{{ video_id }}"
                        class="play-btn absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-[rgba(255,255,255,0.10)] border border-[rgba(255,255,255,0.20)] backdrop-blur-sm hover:bg-gray-100 size-14 flex items-center justify-center rounded-full shadow-[0_0_44px_0_rgba(0,0,0,0.24)] transition-all cursor-pointer duration-300 hover:scale-110"
                        aria-label="Play video"
                      >
                        <svg
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                          class="text-green"
                        >
                          <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>

          <!-- Navigation -->
          <div
            class="absolute md:block w-full xl:w-[calc(100%+76px)] z-1 left-0 top-1/2 -translate-y-1/2 lg:flex items-center gap-4 ml-0 xl:-ml-9"
          >
            <div class="swiper-button-prev bg-[#FFE380] !text-[#0D2E1D] hover:!text-black !size-10 md:!size-14 rounded-full flex items-center justify-center">
              <svg width="17" height="13" viewBox="0 0 17 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6.66797 1L1.16797 6.5M1.16797 6.5L6.66797 12M1.16797 6.5L15.8346 6.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="swiper-button-next bg-[#FFE380] !text-[#0D2E1D] hover:!text-black !size-10 md:!size-14 rounded-full flex items-center justify-center">
              <svg width="17" height="13" viewBox="0 0 17 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10.332 1L15.832 6.5M15.832 6.5L10.332 12M15.832 6.5L1.16536 6.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Initialize Swiper
      if (typeof Swiper !== 'undefined') {
        new Swiper('.review-slider', {
          loop: true,
          speed: 700,
          navigation: {
            prevEl: '.swiper-button-prev',
            nextEl: '.swiper-button-next',
          },
          grabCursor: true,
          effect: 'slide',
          breakpoints: {
            320: { slidesPerView: 1.2, spaceBetween: 10 },
            640: { slidesPerView: 2, spaceBetween: 20 },
            1024: { slidesPerView: 3, spaceBetween: 30 },
          },
        });
      }

      // Play button functionality
      document.querySelectorAll('.play-btn').forEach((button) => {
        button.addEventListener('click', () => {
          const videoId = button.dataset.videoId;
          const parent = button.closest('.relative');
          parent.innerHTML = `
            <div class="absolute inset-0">
              <iframe 
                src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&playsinline=1"
                class="w-full h-full rounded-xl"
                frameborder="0"
                allow="autoplay; encrypted-media"
                allowfullscreen
              ></iframe>
            </div>
          `;
        });
      });
    });
  </script>
{% endif %}
{%- stylesheet -%}
  .swiper-button-next:after {
    display: none;
  }
  .swiper-button-prev:after {
    display: none;
  }
{%- endstylesheet -%}
{% schema %}
{
  "name": "Product Video Reviews",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Title",
      "default": "Hear Directly From Our Customers"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Section Subtitle",
      "default": "Real experiences, real stories. Watch how our customers share their experiences."
    }
  ],
  "presets": [
    {
      "name": "Product Video Reviews"
    }
  ]
}
{% endschema %}
