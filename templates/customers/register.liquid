<div class="register-page grid grid-cols-1 md:grid-cols-2 bg-[#1E6C44] min-h-screen">
  <div class="overflow-auto py-25 max-h-screen">
    <div class="w-full mx-auto px-5 min-w-full 2xl:min-w-164 lg:w-53.5 mb-7.5 lg:mb-9 xl:mb-11 2xl:mb-12.5">
      <a href="{{ routes.root_url }}" class="w-31.5 mb-7.5 md:mb-9 lg:mb-11 xl:mb-12.5 block mx-auto">
        <img src="{{ 'login-icon.png' | asset_url }}" width="" height="" class="size-full object-center" alt="">
      </a>
      <p class="text-white text-2xl lg:text-3xl xl:text-[32px] font-medium !leading-[1.25] font-poppins mb-1.4 lg:mb-3">
        Sign Up
      </p>
      <p class="text-[#B7D6C6] text-base md:text-lg xl:text-xl !leading-[1.6]">
        Fill your information below or register with your account.
      </p>

      {% form 'create_customer' %}
        {{ form.errors | default_errors }}

        <div class="flex flex-col lg:flex-row gap-4 lg:gap-5 lg:mb-5 mt-5 lg:mt-8">
          <div class="w-full mb-4 md:mb-0">
            <label class="block text-white text-lg mb-2 font-medium font-poppins">First Name*</label>
            <input
              type="text"
              name="customer[first_name]"
              placeholder="Enter First Name"
              required
              class="w-full text-base text-[#B7D6C6] placeholder:text-[#B7D6C6] border border-[#B7D6C6] bg-[#2A7A51] py-4 px-5 rounded-lg"
            >
          </div>
          <div class="w-full mb-4 lg:mb-0">
            <label class="block text-white text-lg mb-2 font-medium font-poppins">Last Name*</label>
            <input
              type="text"
              name="customer[last_name]"
              placeholder="Enter Last Name"
              required
              class="w-full text-base text-[#B7D6C6] placeholder:text-[#B7D6C6] border border-[#B7D6C6] bg-[#2A7A51] py-4 px-5 rounded-lg"
            >
          </div>
        </div>

        <div class="w-full mb-4 lg:mb-5">
          <label class="block text-white text-lg mb-2 font-medium font-poppins">Email*</label>
          <input
            type="email"
            name="customer[email]"
            placeholder="Enter Email Address"
            required
            class="w-full text-base text-[#B7D6C6] placeholder:text-[#B7D6C6] border border-[#B7D6C6] bg-[#2A7A51] py-4 px-5 rounded-lg"
          >
        </div>

        <div class="w-full mb-4 lg:mb-5">
          {% render 'password-input' %}
        </div>

        <div class="w-full mb-4 lg:mb-5">
          <button
            type="submit"
            class="text-[#1F1904] text-base py-4 w-full cursor-pointer font-medium font-poppins text-center px-5 rounded-lg bg-[#FFC801]"
          >
            Sign Up
          </button>
        </div>
      {% endform %}

      <div class="relative z-1 mb-6 lg:mb-8">
        <div class="h-[1px] w-[35%] bg-[#B7D6C6] absolute left-0 top-1/2 -translate-y-1/2"></div>
        <div class="h-[1px] w-[35%] bg-[#B7D6C6] absolute right-0 top-1/2 -translate-y-1/2"></div>
        <p class="text-white text-base font-medium font-poppins text-center">Sign Up with</p>
      </div>

      <!-- Google Signup Placeholder (custom app needed) -->
      <button class="text-[#1E6C44] text-base py-4 w-full flex items-center justify-center gap-2 rounded-lg bg-white">
        <span>G</span> Sign Up With Google
      </button>

      <p class="text-white text-base mt-10 text-center">
        Already have an account? <a href="{{ routes.account_login_url }}" class="text-[#FFC801] underline">Sign In 2</a>
      </p>
    </div>
  </div>

  <div class="hidden md:flex bg-[#FFC801] justify-end py-13 h-screen">
    <img class="w-full object-contain h-full" width="" height="" src="{{ 'login-img.png' | asset_url }}" alt="">
  </div>
</div>
<div
  id="toast"
  class="fixed bottom-5 right-5 bg-red-500 text-white px-5 py-3 rounded-lg shadow-lg opacity-0 transition-opacity duration-500 z-50"
></div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('signup-form');
    const toast = document.getElementById('toast');

    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const formData = new FormData(form);

      fetch('/account', {
        method: 'POST',
        body: formData,
      })
        .then((response) => response.text())
        .then((html) => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');

          const errorElement = doc.querySelector('.errors');
          if (errorElement) {
            const errorText = errorElement.textContent.trim();

            // Check for "email already associated"
            if (errorText.includes('already associated')) {
              toast.textContent = '❌ This email is already registered. Please login or reset your password.';
            } else {
              toast.textContent = '❌ ' + errorText;
            }

            toast.classList.remove('opacity-0');
            toast.classList.add('opacity-100');

            setTimeout(() => {
              toast.classList.remove('opacity-100');
              toast.classList.add('opacity-0');
            }, 4000);
            return;
          }

          // Success
          toast.textContent = '✅ Registration successful! Redirecting...';
          toast.classList.remove('bg-red-500', 'opacity-0');
          toast.classList.add('bg-green-500', 'opacity-100');

          form.reset();

          setTimeout(() => {
            toast.classList.remove('opacity-100');
            toast.classList.add('opacity-0');
            window.location.href = '/account'; // Redirect to account page
          }, 3000);
        })
        .catch((err) => {
          toast.textContent = '❌ Something went wrong. Please try again.';
          toast.classList.remove('bg-green-500', 'opacity-0');
          toast.classList.add('bg-red-500', 'opacity-100');

          setTimeout(() => {
            toast.classList.remove('opacity-100');
            toast.classList.add('opacity-0');
          }, 4000);
        });
    });
  });
</script>
